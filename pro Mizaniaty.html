<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ميزانتي برو - نظام إدارة الميزانية الاحترافي</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --premium: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --business: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: var(--gradient);
            padding: 20px;
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header Styles */
        .header {
            background: var(--primary);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--secondary);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        /* نظام المستخدم والاشتراك */
        .user-auth {
            position: absolute;
            left: 20px;
            top: 20px;
            display: flex;
            gap: 10px;
        }

        .auth-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .auth-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* نافذة الاشتراكات */
        .subscription-plans {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        .plans-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .plans-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .plans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .plan-card {
            border: 2px solid #eee;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
        }

        .plan-card.featured {
            border-color: var(--secondary);
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .plan-card.premium {
            background: var(--premium);
            color: white;
        }

        .plan-card.business {
            background: var(--business);
            color: white;
        }

        .plan-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .plan-name {
            font-size: 1.5em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .plan-price {
            font-size: 2em;
            margin: 15px 0;
        }

        .plan-features {
            list-style: none;
            margin: 20px 0;
        }

        .plan-features li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }

        /* الإعلانات */
        .ad-container {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
            border-left: 4px solid var(--warning);
        }

        .ad-label {
            background: var(--warning);
            color: white;
            padding: 3px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .premium-badge {
            background: var(--premium);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .business-badge {
            background: var(--business);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            margin-left: 10px;
        }

        /* إعلانات البانر */
        .banner-ad {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            border: 2px dashed var(--warning);
        }

        .ad-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .ad-close {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            color: #999;
        }

        /* نظام اللغات */
        .language-selector {
            position: absolute;
            right: 20px;
            top: 20px;
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .lang-btn.active {
            background: var(--secondary);
            border-color: var(--secondary);
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* الميزات الاحترافية */
        .premium-feature {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(240, 147, 251, 0.1));
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #f5576c;
        }

        .business-feature {
            background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(79, 172, 254, 0.1));
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #00f2fe;
        }

        .feature-lock {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 30px;
            text-align: center;
            background: rgba(0,0,0,0.03);
            border-radius: 10px;
            margin: 10px 0;
        }

        .feature-lock i {
            font-size: 3em;
            margin-bottom: 15px;
            color: #bdc3c7;
        }

        /* لوحة التحكم */
        .admin-panel {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .admin-stat {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        /* باقي الأنماط تبقى كما هي مع تحسينات */
        .month-input {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .month-input input, .month-input select {
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            text-align: center;
            min-width: 150px;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: var(--secondary);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .card h2 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid var(--secondary);
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* باقي الأنماط تبقى كما هي */
        /* ... */

    </style>
</head>
<body>
    <div class="container">
        <!-- البانر الرئيسي -->
        <header class="header">
            <div class="user-auth" id="userAuth">
                <button class="auth-btn" onclick="showLogin()">تسجيل الدخول</button>
                <button class="auth-btn" onclick="showSubscriptionPlans()">الاشتراك</button>
            </div>

            <div class="language-selector">
                <button class="lang-btn active" data-lang="ar">العربية</button>
                <button class="lang-btn" data-lang="en">English</button>
                <button class="lang-btn" data-lang="es">Español</button>
            </div>

            <h1><i class="fas fa-crown"></i> ميزانتي برو - النسخة الاحترافية</h1>
            <p>أداة متكاملة لإدارة الميزانية الشخصية والمؤسسية مع إمكانيات متقدمة</p>
            
            <!-- إعلان -->
            <div class="ad-container">
                <span class="ad-label">إعلان</span>
                <span id="adContent">ترقبوا إطلاق النسخة المميزة مع ميزات متقدمة للتقارير والتحليلات!</span>
            </div>

            <div class="month-input">
                <input type="text" id="month" placeholder="الشهر" value="يناير">
                <input type="number" id="year" placeholder="السنة" value="2024">
                <select id="currency">
                    <!-- سيتم ملء العملات ديناميكياً -->
                </select>
            </div>
        </header>

        <!-- إعلان بانر -->
        <div class="banner-ad" id="bannerAd">
            <div class="ad-content">
                <span>✨ <strong>عرض خاص:</strong> احصل على خصم 20% على الاشتراك السنوي! استخدم الكود: PRO20</span>
                <button class="ad-close" onclick="closeBannerAd()">&times;</button>
            </div>
        </div>

        <!-- لوحة تحكم المشرف (للأغراض التجارية) -->
        <div class="admin-panel" id="adminPanel">
            <h2><i class="fas fa-tachometer-alt"></i> لوحة تحكم المشرف</h2>
            <div class="admin-stats">
                <div class="admin-stat">
                    <h3>إجمالي المستخدمين</h3>
                    <div class="value">1,247</div>
                </div>
                <div class="admin-stat">
                    <h3>المشتركين المميزين</h3>
                    <div class="value">328</div>
                </div>
                <div class="admin-stat">
                    <h3>الإيرادات الشهرية</h3>
                    <div class="value">$8,420</div>
                </div>
                <div class="admin-stat">
                    <h3>نسبة التحويل</h3>
                    <div class="value">12.4%</div>
                </div>
            </div>
            <button class="btn-save" onclick="generateRevenueReport()">تقرير الإيرادات</button>
        </div>

        <!-- نظام التبويب -->
        <div class="tabs">
            <div class="tab active" data-tab="budget">الميزانية</div>
            <div class="tab" data-tab="reports">التقارير <span class="premium-badge">Pro</span></div>
            <div class="tab" data-tab="goals">الأهداف</div>
            <div class="tab" data-tab="advanced">الميزات المتقدمة <span class="premium-badge">Pro</span></div>
            <div class="tab" data-tab="business">إدارة الأعمال <span class="business-badge">Business</span></div>
        </div>

        <!-- تبويب الميزانية -->
        <div class="tab-content active" id="budget-tab">
            <div class="dashboard">
                <!-- قسم الدخل الشهري -->
                <div class="card">
                    <h2><i class="fas fa-money-bill-wave"></i> الإيرادات الشهرية</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>المصدر</th>
                                <th>المخطط</th>
                                <th>الفعلي</th>
                                <th>الفرق</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>الراتب الأساسي</td>
                                <td><input type="number" class="planned income" value="5000"></td>
                                <td><input type="number" class="actual income" value="5000"></td>
                                <td><span class="difference">0</span></td>
                            </tr>
                            <tr>
                                <td>الدخل الإضافي</td>
                                <td><input type="number" class="planned income" value="1000"></td>
                                <td><input type="number" class="actual income" value="800"></td>
                                <td><span class="difference">-200</span></td>
                            </tr>
                            <tr>
                                <td>استثمارات</td>
                                <td><input type="number" class="planned income" value="300"></td>
                                <td><input type="number" class="actual income" value="350"></td>
                                <td><span class="difference">50</span></td>
                            </tr>
                            <tr class="total-row">
                                <td>الإجمالي</td>
                                <td><span id="total-income-planned">6300</span></td>
                                <td><span id="total-income-actual">6150</span></td>
                                <td><span id="total-income-difference">-150</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- باقي أقسام الميزانية -->
                <!-- ... -->
            </div>
        </div>

        <!-- تبويب التقارير (مميز) -->
        <div class="tab-content" id="reports-tab">
            <div class="premium-feature">
                <h3><i class="fas fa-crown"></i> التقارير المتقدمة</h3>
                <p>هذا القسم متاح للمشتركين في الباقة المميزة فقط. قم بالترقية الآن للوصول إلى:</p>
                <ul>
                    <li>تقارير تحليلية مفصلة</li>
                    <li>مقارنات مع فترات سابقة</li>
                    <li>تنبؤات مالية ذكية</li>
                    <li>تقارير قابلة للتخصيص الكامل</li>
                </ul>
                <button class="btn-save" onclick="showSubscriptionPlans()">الترقية الآن</button>
            </div>
        </div>

        <!-- تبويب الميزات المتقدمة (مميز) -->
        <div class="tab-content" id="advanced-tab">
            <div class="premium-feature">
                <h3><i class="fas fa-rocket"></i> الميزات المتقدمة</h3>
                <p>هذه الميزات متاحة للمشتركين في الباقة المميزة فقط</p>
                <div class="feature-lock">
                    <i class="fas fa-lock"></i>
                    <h4>محتوى مقفل</h4>
                    <p>قم بالترقية الآن للوصول إلى الميزات المتقدمة</p>
                    <button class="btn-save" onclick="showSubscriptionPlans()">الترقية الآن</button>
                </div>
            </div>
        </div>

        <!-- تبويب إدارة الأعمال (للشركات) -->
        <div class="tab-content" id="business-tab">
            <div class="business-feature">
                <h3><i class="fas fa-building"></i> إدارة الأعمال</h3>
                <p>هذا القسم متاح لمشتركي باقة الأعمال فقط. قم بالترقية الآن للوصول إلى:</p>
                <ul>
                    <li>إدارة فرق العمل المتعددة</li>
                    <li>تقارير مخصصة للشركات</li>
                    <li>تكامل مع أنظمة المحاسبة</li>
                    <li>دعم فني متميز 24/7</li>
                </ul>
                <button class="btn-save" onclick="showSubscriptionPlans()">الترقية الآن</button>
            </div>
        </div>

        <!-- ملخص الأداء الشهري -->
        <div class="card summary">
            <h2><i class="fas fa-chart-bar"></i> النتيجة النهائية</h2>
            <div class="summary-grid">
                <div class="summary-item">
                    <h3>إجمالي الدخل</h3>
                    <div class="value" id="final-income">6,150</div>
                </div>
                <div class="summary-item">
                    <h3>إجمالي المصروفات</h3>
                    <div class="value" id="final-expenses">3,580</div>
                </div>
                <div class="summary-item">
                    <h3>إجمالي المدخرات</h3>
                    <div class="value" id="final-savings">950</div>
                </div>
                <div class="summary-item">
                    <h3>الفائض/العجز</h3>
                    <div class="value" id="final-balance">1,620</div>
                </div>
            </div>
            
            <!-- إعلان داخل المحتوى -->
            <div class="ad-container">
                <span class="ad-label">إعلان</span>
                <span>جرب النسخة المميزة مجاناً لمدة 14 يوم! <a href="#" onclick="showSubscriptionPlans()">ابدأ التجربة المجانية</a></span>
            </div>
            
            <div class="btn-group">
                <button class="btn-save" onclick="saveData()"><i class="fas fa-save"></i> حفظ البيانات</button>
                <button class="btn-reset" onclick="resetData()"><i class="fas fa-redo"></i> إعادة تعيين</button>
                <button class="btn-print" onclick="window.print()"><i class="fas fa-print"></i> طباعة التقرير</button>
                <button class="btn-export" onclick="exportData()"><i class="fas fa-download"></i> تصدير البيانات</button>
            </div>
        </div>
    </div>

    <!-- نافذة خطط الاشتراك -->
    <div class="subscription-plans" id="subscriptionPlans">
        <div class="plans-container">
            <div class="plans-header">
                <h2>اختر خطة الاشتراك المناسبة لك</h2>
                <p>ابدأ مجاناً وقم بالترقية في أي وقت</p>
            </div>
            
            <div class="plans-grid">
                <div class="plan-card">
                    <div class="plan-name">مجاني</div>
                    <div class="plan-price">0 <span>ر.س/شهر</span></div>
                    <ul class="plan-features">
                        <li>إدارة الميزانية الأساسية</li>
                        <li>تقارير شهرية بسيطة</li>
                        <li>تخزين محلي للبيانات</li>
                        <li>إعلانات عرضية</li>
                        <li>دعم عبر البريد الإلكتروني</li>
                    </ul>
                    <button class="auth-btn" onclick="selectPlan('free')">اختيار الخطة</button>
                </div>
                
                <div class="plan-card featured premium">
                    <div class="plan-name">بريميوم</div>
                    <div class="plan-price">29 <span>ر.س/شهر</span></div>
                    <ul class="plan-features">
                        <li>جميع ميزات الخطة المجانية</li>
                        <li>تقارير متقدمة وتحليلات</li>
                        <li>مزامنة بين الأجهزة</li>
                        <li>نسخ احتياطي تلقائي</li>
                        <li>دعم فني متميز</li>
                        <li>بدون إعلانات</li>
                        <li>تصدير بيانات متقدم</li>
                    </ul>
                    <button class="btn-save" onclick="selectPlan('premium')">اختيار الخطة</button>
                </div>
                
                <div class="plan-card business">
                    <div class="plan-name">الأعمال</div>
                    <div class="plan-price">99 <span>ر.س/شهر</span></div>
                    <ul class="plan-features">
                        <li>جميع ميزات الخطة المميزة</li>
                        <li>إدارة فرق العمل</li>
                        <li>تقارير مخصصة للشركات</li>
                        <li>API للتكامل مع الأنظمة</li>
                        <li>أولوية في الدعم الفني</li>
                        <li>تحليلات متقدمة للأعمال</li>
                        <li>إدارة متعددة المستخدمين</li>
                    </ul>
                    <button class="auth-btn" onclick="selectPlan('business')">اختيار الخطة</button>
                </div>
            </div>
            
            <button class="btn-reset" onclick="closeSubscriptionPlans()" style="margin-top: 20px;">إغلاق</button>
        </div>
    </div>

    <!-- منطقة الإشعارات -->
    <div class="notifications" id="notifications"></div>

    <script>
        // نظام المستخدم والاشتراك
        let currentUser = null;
        let userSubscription = 'free'; // free, premium, business
        let adminMode = false;

        // بيانات الإعلانات
        const ads = [
            "ترقبوا إطلاق النسخة المميزة مع ميزات متقدمة للتقارير والتحليلات!",
            "احصل على خصم 20% على الاشتراك السنوي! استخدم الكود: PRO20",
            "جرب النسخة المميزة مجاناً لمدة 14 يوم!",
            "ميزانتي برو - الأداة المفضلة للإدارة المالية للشركات الناشئة",
            "انضم إلى آلاف المستخدمين الراضين عن خدماتنا!"
        ];

        // نظام الترجمة متعدد اللغات
        const translations = {
            ar: {
                app_title: "ميزانتي برو - النسخة الاحترافية",
                app_subtitle: "أداة متكاملة لإدارة الميزانية الشخصية والمؤسسية مع إمكانيات متقدمة",
                tab_budget: "الميزانية",
                tab_reports: "التقارير",
                tab_goals: "الأهداف",
                tab_advanced: "الميزات المتقدمة",
                tab_business: "إدارة الأعمال"
            },
            en: {
                app_title: "MyBudget Pro - Professional Version",
                app_subtitle: "Comprehensive tool for personal and corporate budget management with advanced capabilities",
                tab_budget: "Budget",
                tab_reports: "Reports",
                tab_goals: "Goals",
                tab_advanced: "Advanced Features",
                tab_business: "Business Management"
            },
            es: {
                app_title: "MiPresupuesto Pro - Versión Profesional",
                app_subtitle: "Herramienta integral para la gestión de presupuestos personales y corporativos con capacidades avanzadas",
                tab_budget: "Presupuesto",
                tab_reports: "Informes",
                tab_goals: "Metas",
                tab_advanced: "Características Avanzadas",
                tab_business: "Gestión Empresarial"
            }
        };

        // قائمة العملات العالمية
        const currencies = [
            { code: 'USD', name: 'دولار أمريكي (USD)', symbol: '$' },
            { code: 'EUR', name: 'يورو (EUR)', symbol: '€' },
            { code: 'GBP', name: 'جنيه إسترليني (GBP)', symbol: '£' },
            { code: 'JPY', name: 'ين ياباني (JPY)', symbol: '¥' },
            { code: 'CNY', name: 'يوان صيني (CNY)', symbol: '¥' },
            { code: 'INR', name: 'روبية هندية (INR)', symbol: '₹' },
            { code: 'RUB', name: 'روبل روسي (RUB)', symbol: '₽' },
            { code: 'BRL', name: 'ريال برازيلي (BRL)', symbol: 'R$' },
            { code: 'CAD', name: 'دولار كندي (CAD)', symbol: 'C$' },
            { code: 'AUD', name: 'دولار أسترالي (AUD)', symbol: 'A$' },
            { code: 'CHF', name: 'فرنك سويسري (CHF)', symbol: 'CHF' },
            { code: 'SEK', name: 'كرونة سويدية (SEK)', symbol: 'kr' },
            { code: 'NOK', name: 'كرونة نرويجية (NOK)', symbol: 'kr' },
            { code: 'DKK', name: 'كرونة دنماركية (DKK)', symbol: 'kr' },
            { code: 'ZAR', name: 'راند جنوب أفريقي (ZAR)', symbol: 'R' },
            { code: 'MXN', name: 'بيزو مكسيكي (MXN)', symbol: '$' },
            { code: 'SGD', name: 'دولار سنغافوري (SGD)', symbol: 'S$' },
            { code: 'HKD', name: 'دولار هونغ كونغ (HKD)', symbol: 'HK$' },
            { code: 'NZD', name: 'دولار نيوزيلندي (NZD)', symbol: 'NZ$' },
            { code: 'KRW', name: 'وون كوري جنوبي (KRW)', symbol: '₩' },
            { code: 'TRY', name: 'ليرة تركية (TRY)', symbol: '₺' },
            { code: 'SAR', name: 'ريال سعودي (SAR)', symbol: 'ر.س' },
            { code: 'AED', name: 'درهم إماراتي (AED)', symbol: 'د.إ' },
            { code: 'EGP', name: 'جنيه مصري (EGP)', symbol: 'ج.م' },
            { code: 'QAR', name: 'ريال قطري (QAR)', symbol: 'ر.ق' },
            { code: 'KWD', name: 'دينار كويتي (KWD)', symbol: 'د.ك' },
            { code: 'OMR', name: 'ريال عماني (OMR)', symbol: 'ر.ع' },
            { code: 'BHD', name: 'دينار بحريني (BHD)', symbol: 'د.ب' }
        ];

        // البيانات والمتغيرات العامة
        let appData = {
            month: 'يناير',
            year: 2024,
            currency: 'SAR',
            language: 'ar',
            goals: [],
            history: []
        };

        // تهيئة التطبيق
        document.addEventListener('DOMContentLoaded', function() {
            initializeCurrencies();
            setupLanguageSelector();
            loadData();
            initCharts();
            setupEventListeners();
            updateCalculations();
            rotateAds(); // بدء تدوير الإعلانات
            showNotification('مرحباً بك في ميزانتي برو! النسخة الاحترافية لإدارة الميزانية.', 'success');
            
            // تفعيل وضع المدير إذا كان المستخدم مسؤولاً
            if (localStorage.getItem('adminMode') === 'true') {
                toggleAdminMode();
            }
        });

        // تهيئة قائمة العملات
        function initializeCurrencies() {
            const currencySelect = document.getElementById('currency');
            currencySelect.innerHTML = '';
            
            currencies.forEach(currency => {
                const option = document.createElement('option');
                option.value = currency.code;
                option.textContent = currency.name;
                if (currency.code === appData.currency) {
                    option.selected = true;
                }
                currencySelect.appendChild(option);
            });
        }

        // إعداد مستمعي الأحداث
        function setupEventListeners() {
            // تحديث الحسابات عند تغيير أي قيمة
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', updateCalculations);
            });

            // تبديل التبويبات
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById(`${this.dataset.tab}-tab`).classList.add('active');
                });
            });

            // تحديث عند تغيير العملة
            document.getElementById('currency').addEventListener('change', function() {
                appData.currency = this.value;
                updateCalculations();
                saveData();
            });
        }

        // إعداد نظام اللغات
        function setupLanguageSelector() {
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const lang = this.dataset.lang;
                    changeLanguage(lang);
                });
            });
        }

        // تغيير اللغة
        function changeLanguage(lang) {
            appData.language = lang;
            
            // تحديث أزرار اللغة
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === lang) {
                    btn.classList.add('active');
                }
            });
            
            // تحديث النصوص
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    element.textContent = translations[lang][key];
                }
            });
            
            // تحديث عناوين الصفحة والنصوص الثابتة
            if (translations[lang]) {
                document.querySelector('.header h1').innerHTML = `<i class="fas fa-crown"></i> ${translations[lang].app_title}`;
                document.querySelector('.header p').textContent = translations[lang].app_subtitle;
            }
            
            // تغيير اتجاه النص
            if (lang === 'ar') {
                document.documentElement.dir = 'rtl';
                document.documentElement.lang = 'ar';
            } else {
                document.documentElement.dir = 'ltr';
                document.documentElement.lang = lang;
            }
            
            saveData();
        }

        // عرض نافذة خطط الاشتراك
        function showSubscriptionPlans() {
            document.getElementById('subscriptionPlans').style.display = 'flex';
        }

        function closeSubscriptionPlans() {
            document.getElementById('subscriptionPlans').style.display = 'none';
        }

        function selectPlan(plan) {
            if (plan === 'free') {
                userSubscription = 'free';
                showNotification('تم تفعيل الخطة المجانية بنجاح', 'success');
            } else {
                // في التطبيق الحقيقي، هنا نوجه المستخدم لصفحة الدفع
                showNotification(`سيتم توجيهك لصفحة الدفع لخطة ${plan}`, 'info');
                // محاكاة عملية الدفع الناجحة
                setTimeout(() => {
                    userSubscription = plan;
                    updateUIForSubscription();
                    showNotification(`تم تفعيل الخطة ${plan} بنجاح!`, 'success');
                }, 2000);
            }
            closeSubscriptionPlans();
            updateUIForSubscription();
        }

        function updateUIForSubscription() {
            // إظهار أو إخفاء الميزات حسب الاشتراك
            const premiumFeatures = document.querySelectorAll('.premium-feature, .premium-badge');
            const businessFeatures = document.querySelectorAll('.business-feature, .business-badge');
            const adContainers = document.querySelectorAll('.ad-container, .banner-ad');
            
            if (userSubscription === 'free') {
                premiumFeatures.forEach(feature => {
                    feature.style.display = 'block';
                });
                businessFeatures.forEach(feature => {
                    feature.style.display = 'block';
                });
                adContainers.forEach(ad => {
                    ad.style.display = 'block';
                });
            } else if (userSubscription === 'premium') {
                premiumFeatures.forEach(feature => {
                    feature.style.display = 'none';
                });
                businessFeatures.forEach(feature => {
                    feature.style.display = 'block';
                });
                adContainers.forEach(ad => {
                    ad.style.display = 'none';
                });
            } else if (userSubscription === 'business') {
                premiumFeatures.forEach(feature => {
                    feature.style.display = 'none';
                });
                businessFeatures.forEach(feature => {
                    feature.style.display = 'none';
                });
                adContainers.forEach(ad => {
                    ad.style.display = 'none';
                });
            }
            
            // تحديث واجهة المستخدم
            updateUserInterface();
        }

        function rotateAds() {
            const adContent = document.getElementById('adContent');
            let currentAdIndex = 0;
            
            setInterval(() => {
                currentAdIndex = (currentAdIndex + 1) % ads.length;
                if (adContent) {
                    adContent.textContent = ads[currentAdIndex];
                }
            }, 8000); // تغيير الإعلان كل 8 ثوان
        }

        function closeBannerAd() {
            document.getElementById('bannerAd').style.display = 'none';
        }

        function showLogin() {
            // في التطبيق الحقيقي، نفتح نافذة تسجيل الدخول
            const email = prompt('أدخل بريدك الإلكتروني:');
            if (email) {
                // محاكاة تسجيل الدخول الناجح
                currentUser = {
                    email: email,
                    name: email.split('@')[0]
                };
                updateUserInterface();
                showNotification(`مرحباً بعودتك، ${currentUser.name}!`, 'success');
                
                // إذا كان البريد الإلكتروني للمسؤول، عرض خيار وضع المدير
                if (email === 'admin@mizannati.com') {
                    setTimeout(() => {
                        if (confirm('هل تريد تفعيل وضع المدير؟')) {
                            toggleAdminMode();
                        }
                    }, 1000);
                }
            }
        }

        function updateUserInterface() {
            const userAuth = document.getElementById('userAuth');
            
            if (currentUser) {
                userAuth.innerHTML = `
                    <div class="user-profile">
                        <div class="user-avatar">${currentUser.name.charAt(0).toUpperCase()}</div>
                        <span>${currentUser.name}</span>
                        <button class="auth-btn" onclick="logout()">تسجيل الخروج</button>
                    </div>
                `;
            } else {
                userAuth.innerHTML = `
                    <button class="auth-btn" onclick="showLogin()">تسجيل الدخول</button>
                    <button class="auth-btn" onclick="showSubscriptionPlans()">الاشتراك</button>
                `;
            }
            
            // تحديث حالة الاشتراك في الواجهة
            const subscriptionBadge = document.createElement('span');
            subscriptionBadge.className = userSubscription === 'free' ? 'premium-badge' : 
                                         userSubscription === 'premium' ? 'premium-badge' : 'business-badge';
            subscriptionBadge.textContent = userSubscription === 'free' ? 'مجاني' : 
                                           userSubscription === 'premium' ? 'بريميوم' : 'أعمال';
            
            // إضافة بادئة الاشتراك بجانب اسم المستخدم إذا كان مسجل الدخول
            if (currentUser) {
                const existingBadge = userAuth.querySelector('.premium-badge, .business-badge');
                if (existingBadge) {
                    existingBadge.remove();
                }
                userAuth.querySelector('.user-profile').appendChild(subscriptionBadge);
            }
        }

        function logout() {
            currentUser = null;
            userSubscription = 'free';
            updateUserInterface();
            updateUIForSubscription();
            showNotification('تم تسجيل الخروج بنجاح', 'success');
        }

        // تفعيل/إلغاء وضع المدير
        function toggleAdminMode() {
            adminMode = !adminMode;
            const adminPanel = document.getElementById('adminPanel');
            
            if (adminMode) {
                adminPanel.style.display = 'block';
                localStorage.setItem('adminMode', 'true');
                showNotification('تم تفعيل وضع المدير', 'success');
            } else {
                adminPanel.style.display = 'none';
                localStorage.setItem('adminMode', 'false');
                showNotification('تم إلغاء وضع المدير', 'success');
            }
        }

        // إنشاء تقرير الإيرادات (للمسؤولين)
        function generateRevenueReport() {
            const reportData = {
                totalUsers: 1247,
                premiumUsers: 328,
                businessUsers: 95,
                monthlyRevenue: 8420,
                conversionRate: 12.4,
                popularPlan: 'premium'
            };
            
            alert(`تقرير الإيرادات:\n\nإجمالي المستخدمين: ${reportData.totalUsers}\nالمشتركين المميزين: ${reportData.premiumUsers}\nمشتركي الأعمال: ${reportData.businessUsers}\nالإيرادات الشهرية: $${reportData.monthlyRevenue}\nنسبة التحويل: ${reportData.conversionRate}%`);
        }

        // باقي الدوال تبقى كما هي مع إضافة حفظ حالة الاشتراك
        function saveData() {
            const data = {
                month: document.getElementById('month').value,
                year: document.getElementById('year').value,
                currency: document.getElementById('currency').value,
                language: appData.language,
                inputs: {},
                goals: appData.goals,
                user: currentUser,
                subscription: userSubscription
            };
            
            // حفظ قيم المدخلات
            document.querySelectorAll('input').forEach(input => {
                if (input.type === 'number') {
                    data.inputs[input.className + '-' + Array.from(input.parentNode.parentNode.cells)[0].textContent] = input.value;
                }
            });
            
            localStorage.setItem('mizannati-pro-data', JSON.stringify(data));
        }

        function loadData() {
            const saved = localStorage.getItem('mizannati-pro-data');
            if (saved) {
                const data = JSON.parse(saved);
                appData = { ...appData, ...data };
                
                // تحميل القيم المحفوظة
                document.getElementById('month').value = data.month || 'يناير';
                document.getElementById('year').value = data.year || 2024;
                document.getElementById('currency').value = data.currency || 'SAR';
                
                if (data.goals) {
                    appData.goals = data.goals;
                    updateGoalsDisplay();
                }
                
                if (data.user) {
                    currentUser = data.user;
                }
                
                if (data.subscription) {
                    userSubscription = data.subscription;
                }
                
                // ملء الحقول المحفوظة
                if (data.inputs) {
                    for (const [key, value] of Object.entries(data.inputs)) {
                        const input = document.querySelector(`input[class*="${key.split('-')[0]}"]`);
                        if (input) {
                            input.value = value;
                        }
                    }
                }
                
                // تغيير اللغة إذا كانت محفوظة
                if (data.language && data.language !== 'ar') {
                    changeLanguage(data.language);
                }
                
                updateUIForSubscription();
                showNotification('تم تحميل بياناتك المحفوظة', 'success');
            }
            
            // تحديث قائمة العملات بعد تحميل البيانات
            initializeCurrencies();
        }

        // باقي الدوال الأساسية تبقى كما هي
        // ... (يجب تضمين جميع الدوال الأساسية من الكود الأصلي)

    </script>
</body>
</html>
